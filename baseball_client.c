/**
 * baseball_client.c - ìˆ«ì ì•¼êµ¬ ë„¤íŠ¸ì›Œí¬ ê²Œì„ í´ë¼ì´ì–¸íŠ¸
 * 
 * ğŸ“‹ ì£¼ìš” ê¸°ëŠ¥:
 * - TCP ì†Œì¼“ì„ í†µí•œ ê²Œì„ ì„œë²„ ì—°ê²°
 * - ì‹¤ì‹œê°„ ì–‘ë°©í–¥ í†µì‹ ìœ¼ë¡œ ê²Œì„ ì§„í–‰
 * - í’ë¶€í•œ Unicode UI/UX ì œê³µ
 * - ì‚¬ìš©ì ì…ë ¥ ì²˜ë¦¬ ë° ëª…ë ¹ì–´ íŒŒì‹±
 * - ê²Œì„ ìƒíƒœ ì‹œê°í™” ë° ê²°ê³¼ í‘œì‹œ
 * 
 * ğŸ¨ UI/UX íŠ¹ì§•:
 * - ì• ë‹ˆë©”ì´ì…˜ ë°°ë„ˆì™€ ìƒ‰ìƒ í‘œì‹œ
 * - ì‹¤ì‹œê°„ ê²Œì„ ìƒíƒœ ì—…ë°ì´íŠ¸
 * - ì§ê´€ì ì¸ ëª…ë ¹ì–´ ì‹œìŠ¤í…œ
 * - ìƒì„¸í•œ ê²°ê³¼ ì‹œê°í™” (ìŠ¤íŠ¸ë¼ì´í¬/ë³¼)
 * - ìŠ¹ë¦¬/íŒ¨ë°° í™”ë©´ ì—°ì¶œ
 * 
 * ğŸ”§ ê¸°ìˆ ì  íŠ¹ì§•:
 * - ë¹„ë™ê¸° ë©”ì‹œì§€ ìˆ˜ì‹  ì²˜ë¦¬
 * - JSON í”„ë¡œí† ì½œ ê¸°ë°˜ í†µì‹ 
 * - ì—ëŸ¬ ì²˜ë¦¬ ë° ì‚¬ìš©ì í”¼ë“œë°±
 * - ëª…ë ¹ì–´ ê²€ì¦ ë° ì…ë ¥ íŒŒì‹±
 * 
 * ë„¤íŠ¸ì›Œí¬ í”„ë¡œê·¸ë˜ë° ê³¼ì œìš© - ê³ ê¸‰ TCP í´ë¼ì´ì–¸íŠ¸ êµ¬í˜„
 */

#include <stdio.h>
#include <stdlib.h>
#include <string.h>
#include <unistd.h>
#include <arpa/inet.h>
#include <sys/socket.h>

#include "baseball_protocol.h"

// â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
// í´ë¼ì´ì–¸íŠ¸ ê²Œì„ ìƒíƒœ ì „ì—­ ë³€ìˆ˜
// â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
int my_player_id = -1;      // ì„œë²„ì—ì„œ í• ë‹¹ë°›ì€ í”Œë ˆì´ì–´ ID (0 ë˜ëŠ” 1)
int game_started = 0;       // ê²Œì„ ì‹œì‘ ì—¬ë¶€ (0: ëŒ€ê¸°ì¤‘, 1: ì‹œì‘ë¨)
int number_set = 0;         // ë‚´ ìˆ«ì ì„¤ì • ì™„ë£Œ ì—¬ë¶€ (0: ë¯¸ì„¤ì •, 1: ì„¤ì •ì™„ë£Œ)
int my_turn = 0;            // í˜„ì¬ ë‚´ í„´ ì—¬ë¶€ (0: ìƒëŒ€í„´, 1: ë‚´í„´)

// â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
// JSON ì†¡ìˆ˜ì‹  í•¨ìˆ˜ë“¤ (Network Communication Layer)
// ì„œë²„ì™€ ë™ì¼í•œ í”„ë¡œí† ì½œ ì‚¬ìš©: [2ë°”ì´íŠ¸ ê¸¸ì´] + [JSON ë¬¸ìì—´]
// â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

/**
 * JSON ê°ì²´ë¥¼ ì„œë²„ë¡œ ì „ì†¡
 * ì„œë²„ì™€ ë™ì¼í•œ í”„ë¡œí† ì½œ ì‚¬ìš©
 * 
 * @param fd: ì„œë²„ ì†Œì¼“ íŒŒì¼ ë””ìŠ¤í¬ë¦½í„°
 * @param jobj: ì „ì†¡í•  JSON ê°ì²´
 * @return: ì„±ê³µ ì‹œ 0, ì‹¤íŒ¨ ì‹œ -1
 */
int send_json(int fd, struct json_object *jobj) {
    const char *s = json_object_to_json_string(jobj);
    int len = strlen(s);
    uint16_t netlen = htons(len);  // ë„¤íŠ¸ì›Œí¬ ë°”ì´íŠ¸ ìˆœì„œë¡œ ë³€í™˜
    
    // 1ë‹¨ê³„: ë©”ì‹œì§€ ê¸¸ì´ ì „ì†¡ (2ë°”ì´íŠ¸)
    if (send(fd, &netlen, sizeof(netlen), 0) != sizeof(netlen)) {
        printf("ğŸš¨ ì„œë²„ í†µì‹  ì˜¤ë¥˜: ë©”ì‹œì§€ ê¸¸ì´ ì „ì†¡ ì‹¤íŒ¨\n");
        return -1;
    }
    
    // 2ë‹¨ê³„: JSON ë¬¸ìì—´ ì „ì†¡
    if (send(fd, s, len, 0) != len) {
        printf("ğŸš¨ ì„œë²„ í†µì‹  ì˜¤ë¥˜: JSON ë°ì´í„° ì „ì†¡ ì‹¤íŒ¨\n");
        return -1;
    }
    
    return 0;
}

/**
 * ì„œë²„ì—ì„œ JSON ê°ì²´ ìˆ˜ì‹ 
 * íƒ€ì„ì•„ì›ƒê³¼ ë¶€ë¶„ ìˆ˜ì‹  ì²˜ë¦¬ í¬í•¨
 * 
 * @param fd: ì„œë²„ ì†Œì¼“ íŒŒì¼ ë””ìŠ¤í¬ë¦½í„°
 * @return: ìˆ˜ì‹ ëœ JSON ê°ì²´ í¬ì¸í„°, ì‹¤íŒ¨ ì‹œ NULL
 */
struct json_object *recv_json(int fd) {
    uint16_t netlen;
    
    // 1ë‹¨ê³„: ë©”ì‹œì§€ ê¸¸ì´ ìˆ˜ì‹  (2ë°”ì´íŠ¸, ì™„ì „ ìˆ˜ì‹ ê¹Œì§€ ëŒ€ê¸°)
    ssize_t n = recv(fd, &netlen, sizeof(netlen), MSG_WAITALL);
    if (n <= 0) {
        if (n == 0) {
            printf("ğŸ”Œ ì„œë²„ê°€ ì—°ê²°ì„ ì¢…ë£Œí–ˆìŠµë‹ˆë‹¤\n");
        } else {
            printf("ğŸš¨ ë„¤íŠ¸ì›Œí¬ ì˜¤ë¥˜: ë©”ì‹œì§€ ê¸¸ì´ ìˆ˜ì‹  ì‹¤íŒ¨\n");
        }
        return NULL;
    }
    
    int len = ntohs(netlen);  // í˜¸ìŠ¤íŠ¸ ë°”ì´íŠ¸ ìˆœì„œë¡œ ë³€í™˜
    
    // ê¸¸ì´ ìœ íš¨ì„± ê²€ì‚¬
    if (len <= 0 || len > BUF_SIZE) {
        printf("ğŸš¨ í”„ë¡œí† ì½œ ì˜¤ë¥˜: ì˜ëª»ëœ ë©”ì‹œì§€ ê¸¸ì´ (%d bytes)\n", len);
        return NULL;
    }
    
    // 2ë‹¨ê³„: JSON ë¬¸ìì—´ ìˆ˜ì‹ 
    char buf[BUF_SIZE + 1];
    n = recv(fd, buf, len, MSG_WAITALL);
    if (n <= 0) {
        printf("ğŸš¨ ë„¤íŠ¸ì›Œí¬ ì˜¤ë¥˜: JSON ë°ì´í„° ìˆ˜ì‹  ì‹¤íŒ¨\n");
        return NULL;
    }
    
    buf[len] = '\0';  // NULL terminator ì¶”ê°€
    
    // 3ë‹¨ê³„: JSON íŒŒì‹±
    struct json_object *jobj = json_tokener_parse(buf);
    if (jobj == NULL) {
        printf("ğŸš¨ í”„ë¡œí† ì½œ ì˜¤ë¥˜: JSON íŒŒì‹± ì‹¤íŒ¨\n");
        return NULL;
    }
    
    return jobj;
}

// â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
// í™”ë©´ ì œì–´ ë° UI í•¨ìˆ˜ë“¤ (User Interface Layer)
// Unicode ë¬¸ìì™€ ë°•ìŠ¤ ê·¸ë˜í”½ì„ í™œìš©í•œ í’ë¶€í•œ ì‚¬ìš©ì ê²½í—˜ ì œê³µ
// â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

/**
 * í„°ë¯¸ë„ í™”ë©´ ì™„ì „ ì´ˆê¸°í™”
 * ANSI ì´ìŠ¤ì¼€ì´í”„ ì‹œí€€ìŠ¤ë¥¼ ì‚¬ìš©í•œ í™”ë©´ í´ë¦¬ì–´
 */
void clear_screen() {
    printf("\033[2J\033[H");  // í™”ë©´ í´ë¦¬ì–´ ë° ì»¤ì„œ í™ˆìœ¼ë¡œ ì´ë™
}

/**
 * ê²Œì„ ì‹œì‘ ì‹œ ì• ë‹ˆë©”ì´ì…˜ ë°°ë„ˆ ì¶œë ¥
 * ì•¼êµ¬ ì´ëª¨ì§€ì™€ ë°•ìŠ¤ ê·¸ë˜í”½ìœ¼ë¡œ ì‹œê°ì  ì„íŒ©íŠ¸ ì œê³µ
 */
void print_animated_banner() {
    printf("\n");
    printf("    âš¾âš¾âš¾âš¾âš¾âš¾âš¾âš¾âš¾âš¾âš¾âš¾âš¾âš¾âš¾âš¾âš¾âš¾âš¾âš¾âš¾âš¾âš¾âš¾âš¾âš¾âš¾âš¾âš¾âš¾\n");
    printf("   âš¾                                                    âš¾\n");
    printf("  âš¾     ğŸ¯ âœ¨ ìˆ«ì ì•¼êµ¬ ë„¤íŠ¸ì›Œí¬ ê²Œì„ âœ¨ ğŸ¯           âš¾\n");
    printf(" âš¾                                                      âš¾\n");
    printf("âš¾        ğŸ”¥ REAL-TIME NETWORK BASEBALL GAME ğŸ”¥          âš¾\n");
    printf(" âš¾                                                      âš¾\n");
    printf("  âš¾     â­ 1 vs 1 ì˜¨ë¼ì¸ ëŒ€ì „ â­                      âš¾\n");
    printf("   âš¾                                                    âš¾\n");
    printf("    âš¾âš¾âš¾âš¾âš¾âš¾âš¾âš¾âš¾âš¾âš¾âš¾âš¾âš¾âš¾âš¾âš¾âš¾âš¾âš¾âš¾âš¾âš¾âš¾âš¾âš¾âš¾âš¾âš¾âš¾\n");
    printf("\n");
    fflush(stdout);
}

/**
 * ì„œë²„ ì—°ê²° ì‹œ í™˜ì˜ í™”ë©´ ì¶œë ¥
 * ë¡œë”© ë°”ì™€ ì—°ê²° ìƒíƒœë¥¼ ì‹œê°ì ìœ¼ë¡œ í‘œí˜„
 */
void print_welcome_screen() {
    clear_screen();
    print_animated_banner();
    
    printf("â•­â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â•®\n");
    printf("â”‚  ğŸŒŸ í™˜ì˜í•©ë‹ˆë‹¤! Welcome to Baseball Network Game! ğŸŒŸ        â”‚\n");
    printf("â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤\n");
    printf("â”‚                                                             â”‚\n");
    printf("â”‚  ğŸ® ì„œë²„ì— ì—°ê²° ì¤‘... ì ì‹œë§Œ ê¸°ë‹¤ë ¤ì£¼ì„¸ìš”!                    â”‚\n");
    printf("â”‚                                                             â”‚\n");
    printf("â”‚  ğŸ’« Connection Status: [â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆ] 100%%         â”‚\n");
    printf("â”‚                                                             â”‚\n");
    printf("â•°â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â•¯\n");
    printf("\n");
    fflush(stdout);
    usleep(500000); // 0.5ì´ˆ ëŒ€ê¸° (ì‚¬ìš©ì ê²½í—˜ í–¥ìƒ)
}

/**
 * ê²Œì„ ë©”ì¸ í—¤ë” ì¶œë ¥
 * ì¼ê´€ëœ ê²Œì„ ë¸Œëœë”©ê³¼ ì‹œê°ì  ì •ì²´ì„± ì œê³µ
 */
void print_game_header() {
    printf("\n");
    printf("â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—\n");
    printf("â•‘  ğŸ¯ âš¾ ìˆ«ì ì•¼êµ¬ ë„¤íŠ¸ì›Œí¬ ê²Œì„ âš¾ ğŸ¯                             â•‘\n");
    printf("â•‘                                                               â•‘\n");
    printf("â•‘  ğŸ”¥ ì‹¤ì‹œê°„ 1:1 ëŒ€ì „ ğŸ”¥    ğŸ’ 3ìë¦¬ ìˆ«ì ë§ì¶”ê¸° ğŸ’              â•‘\n");
    printf("â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•\n");
    printf("\n");
}

/**
 * í”Œë ˆì´ì–´ ìƒíƒœ ì •ë³´ í‘œì‹œ
 * ID, ì—­í• , í˜„ì¬ ìƒíƒœë¥¼ êµ¬ì¡°í™”í•˜ì—¬ ì¶œë ¥
 * 
 * @param player_id: í”Œë ˆì´ì–´ ID (0 ë˜ëŠ” 1)
 * @param status: í˜„ì¬ ìƒíƒœ ë¬¸ìì—´
 */
void print_player_status(int player_id, const char* status) {
    printf("â•­â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â•®\n");
    printf("â”‚  ğŸ‘¤ í”Œë ˆì´ì–´ ì •ë³´                                             â”‚\n");
    printf("â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤\n");
    printf("â”‚  ğŸ†” ID: %d                                                   â”‚\n", player_id);
    printf("â”‚  ğŸ­ ì—­í• : %s                                                 â”‚\n", player_id == 0 ? "ì„ ê³µ" : "í›„ê³µ");
    printf("â”‚  ğŸ“Š ìƒíƒœ: %s                                                 â”‚\n", status);
    printf("â•°â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â•¯\n");
    printf("\n");
}

/**
 * ê²Œì„ ê·œì¹™ ë° ëª…ë ¹ì–´ ë„ì›€ë§ ì¶œë ¥
 * ìƒˆë¡œìš´ ì‚¬ìš©ìë„ ì‰½ê²Œ ì´í•´í•  ìˆ˜ ìˆë„ë¡ ìƒì„¸í•œ ê°€ì´ë“œ ì œê³µ
 */
void print_game_rules() {
    printf("â•­â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â•®\n");
    printf("â”‚  ğŸ“‹ ê²Œì„ ê·œì¹™ & ëª…ë ¹ì–´                                         â”‚\n");
    printf("â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤\n");
    printf("â”‚                                                             â”‚\n");
    printf("â”‚  ğŸ¯ ëª©í‘œ: ìƒëŒ€ë°©ì˜ 3ìë¦¬ ìˆ«ìë¥¼ ë¨¼ì € ë§ì¶”ë©´ ìŠ¹ë¦¬!               â”‚\n");
    printf("â”‚                                                             â”‚\n");
    printf("â”‚  ğŸ“Š ê²°ê³¼ í•´ì„:                                               â”‚\n");
    printf("â”‚     âš¡ ìŠ¤íŠ¸ë¼ì´í¬: ìˆ«ìì™€ ìœ„ì¹˜ê°€ ëª¨ë‘ ì •í™•                     â”‚\n");
    printf("â”‚     ğŸ”® ë³¼: ìˆ«ìëŠ” ë§ì§€ë§Œ ìœ„ì¹˜ê°€ í‹€ë¦¼                          â”‚\n");
    printf("â”‚                                                             â”‚\n");
    printf("â”‚  ğŸ’» ëª…ë ¹ì–´:                                                  â”‚\n");
    printf("â”‚     ğŸ”¹ set <3ìë¦¬ìˆ«ì>    - ë‚´ ìˆ«ì ì„¤ì • (ì˜ˆ: set 123)       â”‚\n");
    printf("â”‚     ğŸ”¹ guess <3ìë¦¬ìˆ«ì>  - ìƒëŒ€ë°© ìˆ«ì ì¶”ì¸¡ (ì˜ˆ: guess 456) â”‚\n");
    printf("â”‚     ğŸ”¹ help              - ë„ì›€ë§ ë‹¤ì‹œ ë³´ê¸°                 â”‚\n");
    printf("â”‚     ğŸ”¹ quit              - ê²Œì„ ì¢…ë£Œ                       â”‚\n");
    printf("â”‚                                                             â”‚\n");
    printf("â•°â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â•¯\n");
    printf("\n");
}

/**
 * ìƒëŒ€ë°© ëŒ€ê¸° ì¤‘ ì• ë‹ˆë©”ì´ì…˜ ì¶œë ¥
 * ë™ì ì¸ ì  ì• ë‹ˆë©”ì´ì…˜ìœ¼ë¡œ ëŒ€ê¸° ìƒíƒœë¥¼ ì‹œê°í™”
 */
void print_waiting_animation() {
    printf("  â³ ìƒëŒ€ë°©ì„ ê¸°ë‹¤ë¦¬ëŠ” ì¤‘");
    for (int i = 0; i < 3; i++) {
        printf(".");
        fflush(stdout);
        usleep(200000); // 0.2ì´ˆ ëŒ€ê¸°
    }
    printf(" ğŸ­\n");
    printf("  ğŸ’« ê³§ ìƒëŒ€ë°©ì´ ì ‘ì†í•  ì˜ˆì •ì…ë‹ˆë‹¤! ì¡°ê¸ˆë§Œ ê¸°ë‹¤ë ¤ì£¼ì„¸ìš”~\n\n");
}

/**
 * í„´ ìƒíƒœ í‘œì‹œ (ë‚´ í„´ vs ìƒëŒ€ë°© í„´)
 * í˜„ì¬ ê²Œì„ ì§„í–‰ ìƒí™©ì„ ëª…í™•í•˜ê²Œ ì‚¬ìš©ìì—ê²Œ ì•Œë¦¼
 * 
 * @param is_my_turn: ë‚´ í„´ ì—¬ë¶€ (1: ë‚´í„´, 0: ìƒëŒ€í„´)
 */
void print_turn_indicator(int is_my_turn) {
    if (is_my_turn) {
        printf("â•­â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â•®\n");
        printf("â”‚  ğŸ¯ ë‹¹ì‹ ì˜ í„´ì…ë‹ˆë‹¤! YOUR TURN! ğŸ¯                           â”‚\n");
        printf("â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤\n");
        printf("â”‚                                                             â”‚\n");
        printf("â”‚  ğŸ”¥ ìƒëŒ€ë°©ì˜ ìˆ«ìë¥¼ ì¶”ì¸¡í•´ë³´ì„¸ìš”!                            â”‚\n");
        printf("â”‚  ğŸ’¡ ëª…ë ¹ì–´: guess <3ìë¦¬ìˆ«ì>                               â”‚\n");
        printf("â”‚  ğŸ“ ì˜ˆì‹œ: guess 123, guess 456                             â”‚\n");
        printf("â”‚                                                             â”‚\n");
        printf("â•°â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â•¯\n");
    } else {
        printf("â•­â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â•®\n");
        printf("â”‚  â° ìƒëŒ€ë°©ì˜ í„´ - ëŒ€ê¸° ì¤‘... WAITING... â°                   â”‚\n");
        printf("â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤\n");
        printf("â”‚                                                             â”‚\n");
        printf("â”‚  ğŸ¤” ìƒëŒ€ë°©ì´ ì¶”ì¸¡í•˜ê³  ìˆìŠµë‹ˆë‹¤...                            â”‚\n");
        printf("â”‚  â˜• ì»¤í”¼ í•œ ì” í•˜ë©° ê¸°ë‹¤ë ¤ë³´ì„¸ìš”!                            â”‚\n");
        printf("â”‚                                                             â”‚\n");
        printf("â•°â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â•¯\n");
    }
    printf("\n");
}

/**
 * ì¶”ì¸¡ ê²°ê³¼ ì‹œê°í™” (ìŠ¤íŠ¸ë¼ì´í¬/ë³¼ í‘œì‹œ)
 * ê·¸ë˜í”½ ìš”ì†Œë¥¼ ì‚¬ìš©í•˜ì—¬ ê²°ê³¼ë¥¼ ì§ê´€ì ìœ¼ë¡œ í‘œí˜„
 * 
 * @param guess: ì¶”ì¸¡í•œ ìˆ«ì
 * @param strikes: ìŠ¤íŠ¸ë¼ì´í¬ ê°œìˆ˜
 * @param balls: ë³¼ ê°œìˆ˜
 * @param attempts: í˜„ì¬ê¹Œì§€ ì‹œë„ íšŸìˆ˜
 */
void print_result_board(const char* guess, int strikes, int balls, int attempts) {
    printf("â•­â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â•®\n");
    printf("â”‚  ğŸ“Š ì¶”ì¸¡ ê²°ê³¼ - GUESS RESULT ğŸ“Š                              â”‚\n");
    printf("â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤\n");
    printf("â”‚                                                             â”‚\n");
    printf("â”‚  ğŸ¯ ì¶”ì¸¡í•œ ìˆ«ì: %s                                          â”‚\n", guess);
    printf("â”‚                                                             â”‚\n");
    
    // ìŠ¤íŠ¸ë¼ì´í¬ ì‹œê°í™” (ë¶ˆê½ƒ ì´ëª¨ì§€ ì‚¬ìš©)
    printf("â”‚  âš¡ ìŠ¤íŠ¸ë¼ì´í¬: %d  ", strikes);
    for (int i = 0; i < strikes; i++) printf("ğŸ”¥");
    for (int i = strikes; i < 3; i++) printf("âšª");
    printf("                              â”‚\n");
    
    // ë³¼ ì‹œê°í™” (ë‹¤ì´ì•„ëª¬ë“œ ì´ëª¨ì§€ ì‚¬ìš©)
    printf("â”‚  ğŸ”® ë³¼: %d         ", balls);
    for (int i = 0; i < balls; i++) printf("ğŸ’");
    for (int i = balls; i < 3; i++) printf("âš«");
    printf("                              â”‚\n");
    
    printf("â”‚                                                             â”‚\n");
    printf("â”‚  ğŸ“ˆ ì‹œë„ íšŸìˆ˜: %dë²ˆ                                          â”‚\n", attempts);
    printf("â”‚                                                             â”‚\n");
    
    // ì •ë‹µì¸ ê²½ìš° ì¶•í•˜ ë©”ì‹œì§€
    if (strikes == 3) {
        printf("â”‚  ğŸŠğŸŠğŸŠ ì¶•í•˜í•©ë‹ˆë‹¤! ì •ë‹µì…ë‹ˆë‹¤! ğŸŠğŸŠğŸŠ                    â”‚\n");
    }
    
    printf("â•°â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â•¯\n");
    printf("\n");
}

void print_victory_screen() {
    printf("\n\n");
    printf("    ğŸŠğŸŠğŸŠğŸŠğŸŠğŸŠğŸŠğŸŠğŸŠğŸŠğŸŠğŸŠğŸŠğŸŠğŸŠğŸŠğŸŠğŸŠğŸŠğŸŠ\n");
    printf("   ğŸŠ                                                    ğŸŠ\n");
    printf("  ğŸŠ     ğŸ†âœ¨ VICTORY! ìŠ¹ë¦¬! CONGRATULATIONS! âœ¨ğŸ†       ğŸŠ\n");
    printf(" ğŸŠ                                                      ğŸŠ\n");
    printf("ğŸŠ        ğŸ¯ YOU ARE THE BASEBALL CHAMPION! ğŸ¯           ğŸŠ\n");
    printf(" ğŸŠ                                                      ğŸŠ\n");
    printf("  ğŸŠ     ğŸŒŸ ìµœê³ ì˜ ì¶”ë¦¬ ì‹¤ë ¥ì„ ë³´ì—¬ì£¼ì…¨ìŠµë‹ˆë‹¤! ğŸŒŸ          ğŸŠ\n");
    printf("   ğŸŠ                                                    ğŸŠ\n");
    printf("    ğŸŠğŸŠğŸŠğŸŠğŸŠğŸŠğŸŠğŸŠğŸŠğŸŠğŸŠğŸŠğŸŠğŸŠğŸŠğŸŠğŸŠğŸŠğŸŠğŸŠ\n");
    printf("\n");
}

void print_defeat_screen() {
    printf("\n\n");
    printf("    ğŸ˜¢ğŸ˜¢ğŸ˜¢ğŸ˜¢ğŸ˜¢ğŸ˜¢ğŸ˜¢ğŸ˜¢ğŸ˜¢ğŸ˜¢ğŸ˜¢ğŸ˜¢ğŸ˜¢ğŸ˜¢ğŸ˜¢ğŸ˜¢ğŸ˜¢ğŸ˜¢ğŸ˜¢ğŸ˜¢\n");
    printf("   ğŸ˜¢                                                    ğŸ˜¢\n");
    printf("  ğŸ˜¢     ğŸ’ª ì•„ì‰½ì§€ë§Œ ì¢‹ì€ ê²½ê¸°ì˜€ìŠµë‹ˆë‹¤! ğŸ’ª                  ğŸ˜¢\n");
    printf(" ğŸ˜¢                                                      ğŸ˜¢\n");
    printf("ğŸ˜¢        ğŸ”¥ ë‹¤ìŒë²ˆì—” ë” ì˜í•  ìˆ˜ ìˆì„ ê±°ì˜ˆìš”! ğŸ”¥           ğŸ˜¢\n");
    printf(" ğŸ˜¢                                                      ğŸ˜¢\n");
    printf("  ğŸ˜¢     â­ í¬ê¸°í•˜ì§€ ë§ˆì„¸ìš”! ì¬ë„ì „í•˜ì„¸ìš”! â­               ğŸ˜¢\n");
    printf("   ğŸ˜¢                                                    ğŸ˜¢\n");
    printf("    ğŸ˜¢ğŸ˜¢ğŸ˜¢ğŸ˜¢ğŸ˜¢ğŸ˜¢ğŸ˜¢ğŸ˜¢ğŸ˜¢ğŸ˜¢ğŸ˜¢ğŸ˜¢ğŸ˜¢ğŸ˜¢ğŸ˜¢ğŸ˜¢ğŸ˜¢ğŸ˜¢ğŸ˜¢ğŸ˜¢\n");
    printf("\n");
}

void print_game_over_info(const char* my_number, const char* opponent_number) {
    printf("â•­â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â•®\n");
    printf("â”‚  ğŸ“ ê²Œì„ ê²°ê³¼ - FINAL RESULT ğŸ“                              â”‚\n");
    printf("â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤\n");
    printf("â”‚                                                             â”‚\n");
    printf("â”‚  ğŸ” ë‹¹ì‹ ì˜ ìˆ«ì:   %s                                       â”‚\n", my_number);
    printf("â”‚  ğŸ­ ìƒëŒ€ë°© ìˆ«ì:   %s                                       â”‚\n", opponent_number);
    printf("â”‚                                                             â”‚\n");
    printf("â”‚  ğŸ’¡ ì˜ ê¸°ì–µí•´ë‘ì„¸ìš”! ë‹¤ìŒ ê²Œì„ì— ë„ì›€ì´ ë  ê±°ì˜ˆìš”!            â”‚\n");
    printf("â”‚                                                             â”‚\n");
    printf("â•°â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â•¯\n");
    printf("\n");
}

void print_input_prompt() {
    printf("â”Œâ”€ ğŸ’¬ ëª…ë ¹ì–´ ì…ë ¥ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”\n");
    printf("â”‚  ");
    fflush(stdout);
}

void print_success_message(const char* message) {
    printf("â”Œâ”€ âœ… ì„±ê³µ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”\n");
    printf("â”‚  %s\n", message);
    printf("â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜\n");
    printf("\n");
}

void print_error_message(const char* message) {
    printf("â”Œâ”€ âŒ ì˜¤ë¥˜ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”\n");
    printf("â”‚  %s\n", message);
    printf("â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜\n");
    printf("\n");
}

// â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
// ëª…ë ¹ì–´ ì²˜ë¦¬
// â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
int handle_user_input(int sockfd) {
    char input[256];
    print_input_prompt();
    
    if (!fgets(input, sizeof(input), stdin)) {
        return -1; // EOF
    }
    
    printf("â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜\n\n");
    
    // ì¤„ë°”ê¿ˆ ì œê±°
    input[strcspn(input, "\n")] = '\0';
    
    // ë¹ˆ ì…ë ¥
    if (strlen(input) == 0) {
        return 0;
    }
    
    // quit ëª…ë ¹
    if (strcmp(input, "quit") == 0) {
        printf("ğŸšª ê²Œì„ì„ ì¢…ë£Œí•©ë‹ˆë‹¤... ì•ˆë…•íˆ ê°€ì„¸ìš”! ğŸ‘‹\n");
        return -1;
    }
    
    // help ëª…ë ¹
    if (strcmp(input, "help") == 0) {
        print_game_rules();
        return 0;
    }
    
    // set ëª…ë ¹ (ìˆ«ì ì„¤ì •)
    if (strncmp(input, "set ", 4) == 0) {
        if (number_set) {
            print_error_message("ì´ë¯¸ ìˆ«ìë¥¼ ì„¤ì •í–ˆìŠµë‹ˆë‹¤!");
            return 0;
        }
        
        char *number = input + 4;
        
        if (!is_valid_number(number)) {
            print_error_message("ì˜¬ë°”ë¥´ì§€ ì•Šì€ ìˆ«ìì…ë‹ˆë‹¤! 3ìë¦¬ ì„œë¡œ ë‹¤ë¥¸ ìˆ«ìë¥¼ ì…ë ¥í•˜ì„¸ìš”.");
            printf("   ğŸ’¡ ì˜ˆì‹œ: set 123, set 789\n\n");
            return 0;
        }
        
        struct json_object *jmsg = create_message(ACTION_SET_NUMBER);
        json_object_object_add(jmsg, "number", json_object_new_string(number));
        send_json(sockfd, jmsg);
        json_object_put(jmsg);
        
        char success_msg[100];
        snprintf(success_msg, sizeof(success_msg), "ìˆ«ìë¥¼ ì„¤ì •í–ˆìŠµë‹ˆë‹¤: %s âœ¨", number);
        print_success_message(success_msg);
        return 0;
    }
    
    // guess ëª…ë ¹ (ì¶”ì¸¡)
    if (strncmp(input, "guess ", 6) == 0) {
        if (!my_turn) {
            print_error_message("ì§€ê¸ˆì€ ë‹¹ì‹ ì˜ í„´ì´ ì•„ë‹™ë‹ˆë‹¤!");
            return 0;
        }
        
        char *guess = input + 6;
        
        if (!is_valid_number(guess)) {
            print_error_message("ì˜¬ë°”ë¥´ì§€ ì•Šì€ ìˆ«ìì…ë‹ˆë‹¤! 3ìë¦¬ ì„œë¡œ ë‹¤ë¥¸ ìˆ«ìë¥¼ ì…ë ¥í•˜ì„¸ìš”.");
            printf("   ğŸ’¡ ì˜ˆì‹œ: guess 123, guess 789\n\n");
            return 0;
        }
        
        struct json_object *jmsg = create_message(ACTION_GUESS);
        json_object_object_add(jmsg, "guess", json_object_new_string(guess));
        send_json(sockfd, jmsg);
        json_object_put(jmsg);
        
        return 0;
    }
    
    // ì•Œ ìˆ˜ ì—†ëŠ” ëª…ë ¹
    print_error_message("ì•Œ ìˆ˜ ì—†ëŠ” ëª…ë ¹ì–´ì…ë‹ˆë‹¤. 'help'ë¥¼ ì…ë ¥í•˜ì—¬ ë„ì›€ë§ì„ í™•ì¸í•˜ì„¸ìš”.");
    return 0;
}

// â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
// ì„œë²„ ë©”ì‹œì§€ ì²˜ë¦¬
// â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
int handle_server_message(int sockfd) {
    struct json_object *jmsg = recv_json(sockfd);
    if (!jmsg) {
        print_error_message("ì„œë²„ì™€ì˜ ì—°ê²°ì´ ëŠì–´ì¡ŒìŠµë‹ˆë‹¤.");
        return -1;
    }
    
    struct json_object *jact = NULL;
    if (!json_object_object_get_ex(jmsg, "action", &jact)) {
        json_object_put(jmsg);
        return 0;
    }
    
    const char *action = json_object_get_string(jact);
    
    // í”Œë ˆì´ì–´ ID í• ë‹¹
    if (strcmp(action, ACTION_ASSIGN_ID) == 0) {
        struct json_object *jpid = NULL;
        if (json_object_object_get_ex(jmsg, "player_id", &jpid)) {
            my_player_id = json_object_get_int(jpid);
            print_player_status(my_player_id, "ì—°ê²°ë¨ âœ…");
        }
    }
    
    // ëŒ€ê¸° ë©”ì‹œì§€
    else if (strcmp(action, ACTION_WAIT_PLAYER) == 0) {
        print_waiting_animation();
    }
    
    // ê²Œì„ ì‹œì‘
    else if (strcmp(action, ACTION_GAME_START) == 0) {
        game_started = 1;
        clear_screen();
        print_game_header();
        print_game_rules();
        
        printf("ğŸ® ê²Œì„ì´ ì‹œì‘ë˜ì—ˆìŠµë‹ˆë‹¤! ì´ì œ ë‹¹ì‹ ì˜ ë¹„ë°€ ìˆ«ìë¥¼ ì„¤ì •í•˜ì„¸ìš”!\n");
        printf("ğŸ’¡ 'set <3ìë¦¬ìˆ«ì>' ëª…ë ¹ìœ¼ë¡œ ìˆ«ìë¥¼ ì„¤ì •í•˜ì„¸ìš”! (ì˜ˆ: set 123)\n\n");
    }
    
    // ìˆ«ì ì„¤ì • ì™„ë£Œ
    else if (strcmp(action, ACTION_NUMBER_SET) == 0) {
        number_set = 1;
        print_success_message("ìˆ«ìê°€ ì„±ê³µì ìœ¼ë¡œ ì„¤ì •ë˜ì—ˆìŠµë‹ˆë‹¤! ìƒëŒ€ë°©ì„ ê¸°ë‹¤ë¦¬ëŠ” ì¤‘...");
    }
    
    // ë‚´ í„´
    else if (strcmp(action, ACTION_YOUR_TURN) == 0) {
        my_turn = 1;
        print_turn_indicator(1);
    }
    
    // ìƒëŒ€ë°© í„´
    else if (strcmp(action, ACTION_WAIT_TURN) == 0) {
        my_turn = 0;
        print_turn_indicator(0);
    }
    
    // ì¶”ì¸¡ ê²°ê³¼
    else if (strcmp(action, ACTION_GUESS_RESULT) == 0) {
        struct json_object *jguess = NULL, *jstrikes = NULL, *jballs = NULL, *jattempts = NULL;
        
        if (json_object_object_get_ex(jmsg, "guess", &jguess) &&
            json_object_object_get_ex(jmsg, "strikes", &jstrikes) &&
            json_object_object_get_ex(jmsg, "balls", &jballs) &&
            json_object_object_get_ex(jmsg, "attempts", &jattempts)) {
            
            const char *guess = json_object_get_string(jguess);
            int strikes = json_object_get_int(jstrikes);
            int balls = json_object_get_int(jballs);
            int attempts = json_object_get_int(jattempts);
            
            print_result_board(guess, strikes, balls, attempts);
        }
    }
    
    // ê²Œì„ ì¢…ë£Œ
    else if (strcmp(action, ACTION_GAME_OVER) == 0) {
        struct json_object *jresult = NULL;
        struct json_object *jyour_num = NULL, *jopp_num = NULL;
        
        if (json_object_object_get_ex(jmsg, "result", &jresult)) {
            const char *result = json_object_get_string(jresult);
            if (strcmp(result, "victory") == 0) {
                print_victory_screen();
            } else {
                print_defeat_screen();
            }
        }
        
        // ì •ë‹µ ê³µê°œ
        if (json_object_object_get_ex(jmsg, "your_number", &jyour_num) &&
            json_object_object_get_ex(jmsg, "opponent_number", &jopp_num)) {
            print_game_over_info(json_object_get_string(jyour_num), 
                                json_object_get_string(jopp_num));
        }
        
        printf("ğŸšª ê²Œì„ì´ ì¢…ë£Œë©ë‹ˆë‹¤... ìˆ˜ê³ í•˜ì…¨ìŠµë‹ˆë‹¤! ğŸ‘\n\n");
        json_object_put(jmsg);
        return -1;
    }
    
    // ì—ëŸ¬ ë©”ì‹œì§€
    else if (strcmp(action, ACTION_ERROR) == 0) {
        struct json_object *jmessage = NULL;
        if (json_object_object_get_ex(jmsg, "message", &jmessage)) {
            print_error_message(json_object_get_string(jmessage));
        }
    }
    
    json_object_put(jmsg);
    return 0;
}

// â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
// ë©”ì¸ í•¨ìˆ˜
// â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
int main(int argc, char *argv[]) {
    if (argc != 3) {
        printf("ì‚¬ìš©ë²•: %s <ì„œë²„IP> <í¬íŠ¸>\n", argv[0]);
        return 1;
    }
    
    const char *server_ip = argv[1];
    int port = atoi(argv[2]);
    
    // ì›°ì»´ ìŠ¤í¬ë¦° í‘œì‹œ
    print_welcome_screen();
    
    // ì†Œì¼“ ìƒì„±
    int sockfd = socket(AF_INET, SOCK_STREAM, 0);
    if (sockfd < 0) {
        perror("socket");
        return 1;
    }
    
    // ì„œë²„ ì—°ê²°
    struct sockaddr_in serv_addr;
    memset(&serv_addr, 0, sizeof(serv_addr));
    serv_addr.sin_family = AF_INET;
    serv_addr.sin_port = htons(port);
    inet_pton(AF_INET, server_ip, &serv_addr.sin_addr);
    
    if (connect(sockfd, (struct sockaddr *)&serv_addr, sizeof(serv_addr)) < 0) {
        print_error_message("ì„œë²„ì— ì—°ê²°í•  ìˆ˜ ì—†ìŠµë‹ˆë‹¤. ì„œë²„ê°€ ì‹¤í–‰ ì¤‘ì¸ì§€ í™•ì¸í•´ì£¼ì„¸ìš”.");
        return 1;
    }
    
    clear_screen();
    print_game_header();
    printf("ğŸŠ ì„œë²„ì— ì„±ê³µì ìœ¼ë¡œ ì—°ê²°ë˜ì—ˆìŠµë‹ˆë‹¤! ğŸŠ\n\n");
    print_game_rules();
    
    // ë©”ì¸ ë£¨í”„ (select ì‚¬ìš©)
    fd_set read_fds;
    int max_fd = sockfd;
    
    while (1) {
        FD_ZERO(&read_fds);
        FD_SET(STDIN_FILENO, &read_fds);  // í‘œì¤€ ì…ë ¥
        FD_SET(sockfd, &read_fds);        // ì„œë²„ ì†Œì¼“
        
        int activity = select(max_fd + 1, &read_fds, NULL, NULL, NULL);
        if (activity < 0) {
            perror("select");
            break;
        }
        
        // ì„œë²„ ë©”ì‹œì§€ ì²˜ë¦¬
        if (FD_ISSET(sockfd, &read_fds)) {
            if (handle_server_message(sockfd) < 0) {
                break;
            }
        }
        
        // ì‚¬ìš©ì ì…ë ¥ ì²˜ë¦¬
        if (FD_ISSET(STDIN_FILENO, &read_fds)) {
            if (handle_user_input(sockfd) < 0) {
                break;
            }
        }
    }
    
    close(sockfd);
    return 0;
} 
#!/bin/bash

# μ«μ μ•Όκµ¬ λ„¤νΈμ›ν¬ κ²μ„ - λΉ λ¥Έ μ‹μ—° μ¤ν¬λ¦½νΈ
# μλ™ν™”λ λ°λ¨ (λ°ν‘ μ—°μµμ©)

echo "β•”β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•—"
echo "β•‘              π€ λΉ λ¥Έ μ‹μ—° λ¨λ“ - μλ™ μ‹¤ν–‰ π€                   β•‘"
echo "β•‘                                                               β•‘"
echo "β•‘  π“΅ μ„λ²„μ™€ 2κ° ν΄λΌμ΄μ–ΈνΈλ¥Ό μμ°¨μ μΌλ΅ μ‹¤ν–‰ν•©λ‹λ‹¤                 β•‘"
echo "β•‘  β±οΈ  μ΄ μ‹μ—° μ‹κ°„: μ•½ 30μ΄                                     β•‘"
echo "β•‘                                                               β•‘"
echo "β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•"
echo ""

# μ»΄νμΌ ν™•μΈ
if [ ! -f "./baseball_server" ] || [ ! -f "./baseball_client" ]; then
    echo "π”¨ ν”„λ΅κ·Έλ¨μ„ λ¨Όμ € μ»΄νμΌν•©λ‹λ‹¤..."
    make clean && make all
    echo "β… μ»΄νμΌ μ™„λ£!"
    echo ""
fi

echo "π¬ [1/3] μ„λ²„ μ‹μ‘..."
echo "β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”"
./baseball_server 8080 &
SERVER_PID=$!
sleep 2

echo ""
echo "π® [2/3] μ²« λ²μ§Έ ν΄λΌμ΄μ–ΈνΈ μ ‘μ†..."
echo "β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”"
echo -e "set 123\nquit" | ./baseball_client 127.0.0.1 8080 &
CLIENT1_PID=$!
sleep 3

echo ""
echo "π® [3/3] λ‘ λ²μ§Έ ν΄λΌμ΄μ–ΈνΈ μ ‘μ†..."
echo "β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”"
echo -e "set 456\nquit" | ./baseball_client 127.0.0.1 8080 &
CLIENT2_PID=$!
sleep 5

echo ""
echo "π§Ή μ •λ¦¬ μ¤‘..."
kill $SERVER_PID $CLIENT1_PID $CLIENT2_PID 2>/dev/null
wait $SERVER_PID $CLIENT1_PID $CLIENT2_PID 2>/dev/null

echo ""
echo "β… λΉ λ¥Έ μ‹μ—° μ™„λ£!"
echo "π― μ‹¤μ  λ°ν‘μ—μ„λ” demo_server.sh, demo_client1.sh, demo_client2.shλ¥Ό μ‚¬μ©ν•μ„Έμ”!" 